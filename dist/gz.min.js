var Gamezyme=function(){"use strict";function e(e,t){try{if(window.localStorage){var r=JSON.parse(localStorage.getItem(T)||"{}");r[e]=t,localStorage.setItem(T,JSON.stringify(r))}}catch(n){return}}function t(e){try{if(window.localStorage){var t=JSON.parse(localStorage.getItem(T)||"{}");return t[e]}}catch(r){return}}function r(e){var t=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return e&&t.test(e)?void 0:U[100]}function n(e,t,r){return t&&0!==t.length?!0:(r[r.length]='"'+e+'" parameter required',!1)}function o(e,t,o){switch(e){case"email":if(n(e,t,o)){var i=r(t);i&&(o[o.length]=i)}break;case"password":n(e,t,o);break;case"name":n(e,t,o);break;default:throw"parameter does not exist"}}function i(e){if(e.length>0)throw"ERROR(s): "+e}function a(e,t){return{success:e,errorcode:t,errormessage:void 0}}function s(e,t,r,n,o){var i,s={},u={};o=o||{},o.section=e,o.action=t,o.identifierGame=L,o.version=O,i=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),q.getToken()&&(o.token=q.getToken()),q.getUser()&&(o.identifierPlayer=q.getUser()),s=JSON.stringify(o),u.data=D.base64(s),u.hash=D.md5(s+"privatekey"),i.open("POST",M,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.onreadystatechange=function(){var e;4===i.readyState&&200===i.status&&(200===i.status?(e=JSON.parse(i.responseText),r(n,o,e,new a(e.status,e.error))):400===i.status&&(e={status:"fail",error:{code:0,message:U[1]}},r(n,o,e,new a(!1,e.error.message))))},i.send(JSON.stringify(u))}function u(e){if(!e)throw"Method getStateAuth: Not exists callback";s("players","verifyToken",function(e,t,r,n){e(r)},function(t){var r={status:"success",response:{}},n={};r.response=n,n.state="disconnected",n.type=void 0,t.error||q.getToken()&&q.getType()&&(n.state="connected",n.type=q.getType()),e(r)},void 0)}function c(e,t,r,n,o){q.unregisterCredential();var i=n||!1;q.registerCredential(e,t,r,i),void 0!==o&&u(o)}function l(e){s("healths","receivedError",function(e,t,r,n){window.console.log("sendError result:"+r.status)},void 0,{error:e})}function d(e){if("success"===e.status){var t=e.response;c(t.identifier,t.token,"facebook",!0,function(e){"success"===e.status?E&&E(e):window.console.log(JSON.stringify(e))})}else"critical"===e.status&&l(e.error),"undefined"!==I?I(e):(window.console.log("It is recommended to assign a function error callback"),window.alert("Error!!! "+JSON.stringify(e.error)))}function f(e){d(e)}function g(){if(J){if(J.closed&&(G=!0,clearInterval(R)),!z)try{var e;e=J.location.href.split("#/response="),e.length>1&&(J.close(),z=!0,f(JSON.parse(decodeURIComponent(e[1]))))}catch(t){J&&J.postMessage("hello there!",P)}}else G=!0}function p(e){e.origin===P&&(z||(G=!0,clearInterval(R),z=!0,window.console.log("se recibio respuesta desde popup: "+e.data),f(JSON.parse(decodeURIComponent(e.data)))))}function v(e,t,r,n){void 0!==e&&e(r)}function h(e,t,r,n){var o={},i=!1;t.rememberMe&&t.rememberMe===!0&&(i=!0),"success"===r.status?q.registerCredential(t.email,r.response,i):(q.unregisterCredential(),o.error=r.error),void 0!==e&&(o.status=r.status,o.response=q.isLogged,e(o))}function m(e,t,r,n){void 0!==e&&(void 0===r.response&&(r.response=JSON.stringify({})),e(r,n))}function w(e,t,r,n){q.unregisterCredential(),void 0!==e&&e({status:"success",response:q.isLogged})}function y(e,t,r,n){void 0!==e&&e(r)}function b(e,t,r,n){void 0!==e&&e(r)}function k(e,t,r,n){void 0!==e&&e(r,n)}function C(e,t,r,n){void 0!==e&&e(r)}function S(e,t,r,n){void 0!==e&&e(r)}function A(e,t,r,n){if(void 0!==e){if("success"===r.status&&r.response&&r.response.length>0){var o=0;r.response.forEach(function(e){e.position=o+1,o+=1})}e(r)}}var N,L,O,T,E,I,J,R,x={},M="http://api.gamezyme.com/",P="http://www.gamezyme.com/",U={1:"General error, this typically means the player is unable to connect to the server",2:"Invalid game credentials, make sure you use the right public key",3:"Request timed out",4:"Invalid request",100:"Entered email is not valid email address",101:"Not found parameters 'user' or 'token' in function 'registerCredential'",102:"Parameter 'typeIdentifier' allowed only value [local-signup, facebook, twitter, googlePlus]"},z=!1,G=!0,q={isLogged:!1,user:void 0,token:void 0,type:void 0},D=function(){function e(e){var t,r,n="";if(!e)return n;for(e=e.replace(/\r\n/g,"\n"),t=0;t<e.length;t+=1)r=e.charCodeAt(t),128>r?n+=String.fromCharCode(r):r>127&&2048>r?(n+=String.fromCharCode(r>>6|192),n+=String.fromCharCode(63&r|128)):(n+=String.fromCharCode(r>>12|224),n+=String.fromCharCode(r>>6&63|128),n+=String.fromCharCode(63&r|128));return n}function t(e,t){var r=1&e|1&t,n=e>>>1|t>>>1;return n<<1|r}function r(e,t){var r=1&e^1&t,n=e>>>1^t>>>1;return n<<1|r}function n(e,t){var r=1&e&(1&t),n=e>>>1&t>>>1;return n<<1|r}function o(e,t){var r=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(r>>16);return n<<16|65535&r}function i(e){var t,r="";for(t=0;3>=t;t+=1)r+=p.charAt(e>>8*t+4&15)+p.charAt(e>>8*t&15);return r}function a(e){var t,r=(e.length+8>>6)+1,n=[],o=8*e.length;for(t=0;16*r>t;t+=1)n.push(0);for(t=0;t<e.length;t+=1)n[t>>2]|=e.charCodeAt(t)<<(8*e.length+t)%4*8;return n[t>>2]|=128<<(8*e.length+t)%4*8,n[16*r-2]=255&o,n[16*r-2]|=(o>>>8&255)<<8,n[16*r-2]|=(o>>>16&255)<<16,n[16*r-2]|=(o>>>24&255)<<24,n}function s(e,t){return e<<t|e>>>32-t}function u(e,t,r,n,i,a){return o(s(o(o(t,e),o(n,a)),i),r)}function c(e,r,o,i,a,s,c){return u(t(n(r,o),n(~r,i)),e,r,a,s,c)}function l(e,r,o,i,a,s,c){return u(t(n(r,i),n(o,~i)),e,r,a,s,c)}function d(e,t,n,o,i,a,s){return u(r(r(t,n),o),e,t,i,a,s)}function f(e,n,o,i,a,s,c){return u(r(o,t(n,~i)),e,n,a,s,c)}var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p="0123456789abcdef",v={};return v.base64=function(t){var r,n,o,i,a,s,u,c="",l=0;for(t=e(t);l<t.length;)r=t.charCodeAt(l),l+=1,n=t.charCodeAt(l),l+=1,o=t.charCodeAt(l),l+=1,i=r>>2,a=(3&r)<<4|n>>4,s=(15&n)<<2|o>>6,u=63&o,isNaN(n)?s=u=64:isNaN(o)&&(u=64),c=c+g.charAt(i)+g.charAt(a)+g.charAt(s)+g.charAt(u);return c},v.md5=function(e){var t,r,n,s,u,g=a(e),p=1732584193,v=-271733879,h=-1732584194,m=271733878;for(u=0;u<g.length;u+=16)t=p,r=v,n=h,s=m,p=c(p,v,h,m,g[u],7,-680876936),m=c(m,p,v,h,g[u+1],12,-389564586),h=c(h,m,p,v,g[u+2],17,606105819),v=c(v,h,m,p,g[u+3],22,-1044525330),p=c(p,v,h,m,g[u+4],7,-176418897),m=c(m,p,v,h,g[u+5],12,1200080426),h=c(h,m,p,v,g[u+6],17,-1473231341),v=c(v,h,m,p,g[u+7],22,-45705983),p=c(p,v,h,m,g[u+8],7,1770035416),m=c(m,p,v,h,g[u+9],12,-1958414417),h=c(h,m,p,v,g[u+10],17,-42063),v=c(v,h,m,p,g[u+11],22,-1990404162),p=c(p,v,h,m,g[u+12],7,1804603682),m=c(m,p,v,h,g[u+13],12,-40341101),h=c(h,m,p,v,g[u+14],17,-1502002290),v=c(v,h,m,p,g[u+15],22,1236535329),p=l(p,v,h,m,g[u+1],5,-165796510),m=l(m,p,v,h,g[u+6],9,-1069501632),h=l(h,m,p,v,g[u+11],14,643717713),v=l(v,h,m,p,g[u],20,-373897302),p=l(p,v,h,m,g[u+5],5,-701558691),m=l(m,p,v,h,g[u+10],9,38016083),h=l(h,m,p,v,g[u+15],14,-660478335),v=l(v,h,m,p,g[u+4],20,-405537848),p=l(p,v,h,m,g[u+9],5,568446438),m=l(m,p,v,h,g[u+14],9,-1019803690),h=l(h,m,p,v,g[u+3],14,-187363961),v=l(v,h,m,p,g[u+8],20,1163531501),p=l(p,v,h,m,g[u+13],5,-1444681467),m=l(m,p,v,h,g[u+2],9,-51403784),h=l(h,m,p,v,g[u+7],14,1735328473),v=l(v,h,m,p,g[u+12],20,-1926607734),p=d(p,v,h,m,g[u+5],4,-378558),m=d(m,p,v,h,g[u+8],11,-2022574463),h=d(h,m,p,v,g[u+11],16,1839030562),v=d(v,h,m,p,g[u+14],23,-35309556),p=d(p,v,h,m,g[u+1],4,-1530992060),m=d(m,p,v,h,g[u+4],11,1272893353),h=d(h,m,p,v,g[u+7],16,-155497632),v=d(v,h,m,p,g[u+10],23,-1094730640),p=d(p,v,h,m,g[u+13],4,681279174),m=d(m,p,v,h,g[u],11,-358537222),h=d(h,m,p,v,g[u+3],16,-722521979),v=d(v,h,m,p,g[u+6],23,76029189),p=d(p,v,h,m,g[u+9],4,-640364487),m=d(m,p,v,h,g[u+12],11,-421815835),h=d(h,m,p,v,g[u+15],16,530742520),v=d(v,h,m,p,g[u+2],23,-995338651),p=f(p,v,h,m,g[u],6,-198630844),m=f(m,p,v,h,g[u+7],10,1126891415),h=f(h,m,p,v,g[u+14],15,-1416354905),v=f(v,h,m,p,g[u+5],21,-57434055),p=f(p,v,h,m,g[u+12],6,1700485571),m=f(m,p,v,h,g[u+3],10,-1894986606),h=f(h,m,p,v,g[u+10],15,-1051523),v=f(v,h,m,p,g[u+1],21,-2054922799),p=f(p,v,h,m,g[u+8],6,1873313359),m=f(m,p,v,h,g[u+15],10,-30611744),h=f(h,m,p,v,g[u+6],15,-1560198380),v=f(v,h,m,p,g[u+13],21,1309151649),p=f(p,v,h,m,g[u+4],6,-145523070),m=f(m,p,v,h,g[u+11],10,-1120210379),h=f(h,m,p,v,g[u+2],15,718787259),v=f(v,h,m,p,g[u+9],21,-343485551),p=o(p,t),v=o(v,r),h=o(h,n),m=o(m,s);return i(p)+i(v)+i(h)+i(m)},v}();return q.registerCredential=function(t,r,n,o){if(!t||!r)throw Gamezyme.ERRORS[101];q.isLogged=!0,q.user=t,q.token=r,q.type=n,o&&(e("user",t),e("token",r),e("type",n))},q.unregisterCredential=function(){q.isLogged=!1,q.user=void 0,q.token=void 0,q.type=void 0,t("user",null),t("token",null),t("type",null)},q.getToken=function(){if(!q.token){var e=t("token");return"null"===e||"undefined"===e?void 0:e}return q.token},q.getUser=function(){return q.user?q.user:t("user")},q.getType=function(){if(!q.type){var e=t("type");return"null"===e||"undefined"===e?void 0:e}return q.type},window.addEventListener?window.addEventListener("message",p,!1):window.attachEvent("message",p),x.init=function(e,t,r){var n,o,i,a,s=document.getElementsByTagName("gs:fb-login-button"),c=e.split("_");if(-1!==c.indexOf("undefined"))throw U[2];if(N=c[0],L=c[1],O="1.0",M+="api/v1?publickey="+N,T=e,void 0!==t&&u(t),void 0!==r&&(I=r),s&&s[0]){if(n=s[0],o=n.getAttribute("onlogin"),i=document.createElement("iframe"),a=document.createElement("span"),!o)throw'Not found "onlogin" function in button login facebook';i.setAttribute("width","1000px"),i.setAttribute("height","1000px"),i.setAttribute("frameborder","0"),i.setAttribute("allowtransparency","true"),i.setAttribute("allowfullscreen","true"),i.setAttribute("scrolling","no"),i.setAttribute("allowfullscreen","true"),i.setAttribute("style","border: none; visibility: visible; width: 65px; height: 22px;"),i.setAttribute("src",M+"/facebook/getButtonLogin"),a.setAttribute("style","vertical-align: bottom; width: 65px; height: 22px;"),a.appendChild(i),n.appendChild(a)}},x.player={localSignUp:function(e,t,r,n){var a=[],u={email:e,password:t,name:r};o("email",e,a),o("password",t,a),o("name",r,a),i(a),q.unregisterCredential(),s("players","localSignUp",v,n,u)},localLogin:function(e,t,r){var n=[],a={email:e,password:t};o("email",e,n),o("password",t,n),i(n),q.unregisterCredential(),s("players","localLogin",h,r,a)},openPopupLoginFacebook:function(e){if(G){var t=600,r=400,n=(window.innerWidth-t)/2,o=(window.innerHeight-r)/2,i=M+"/player/auth/facebook/"+L;J=window.open(i,"LoginWindow","location=1,scrollbars=1,width="+t+",height="+r+",left="+n+",top="+o),J&&(G=!1),z=!1,E=e,R=setInterval(g,1e3)}},isLoggedIn:function(e){var t={status:"success",response:q.isLogged};return void 0===e?t:void e(t)},saveData:function(e,t){s("players","saveData",m,t,{playerDataJSON:e})},getData:function(e){s("players","getData",m,e)},logout:function(e){s("players","logout",w,e)},forgotPassword:function(e,t){var r={email:e};s("players","forgotPassword",y,t,r)},me:function(e){s("players","me",b,e)}},x.game={getAllVars:function(e){s("properties","getGamevars",k,e)},getVar:function(e,t){s("properties","getGamevar",k,t,{key:e})}},x.server={ping:function(e){s("healths","ping",C,e,{type:"html5"})}},x.purchases={register:function(e,t){s("purchases","register",S,t,e)}},x.leaderboard={getGlobal:function(e,t){s("leaderboards","allScores",A,t,{options:e})},getFriends:function(e,t){s("leaderboards","friendsScores",A,t,{options:e})}},x}();