var Gamezyme=function(){"use strict";function e(e,t){try{if(window.localStorage){var n=JSON.parse(localStorage.getItem(O)||"{}");n[e]=t,localStorage.setItem(O,JSON.stringify(n))}}catch(r){return}}function t(e){try{if(window.localStorage){var t=JSON.parse(localStorage.getItem(O)||"{}");return t[e]}}catch(n){return}}function n(e){var t=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return e&&t.test(e)?void 0:M[100]}function r(e,t,n){return t&&0!==t.length?!0:(n[n.length]='"'+e+'" parameter required',!1)}function o(e,t,o){switch(e){case"email":if(r(e,t,o)){var i=n(t);i&&(o[o.length]=i)}break;case"password":r(e,t,o);break;case"name":r(e,t,o);break;default:throw"parameter does not exist"}}function i(e){if(e.length>0)throw"ERROR(s): "+e}function a(e,t){return{success:e,errorcode:t,errormessage:void 0}}function s(e,t,n,r,o){var i,s={},u={};o=o||{},o.section=e,o.action=t,o.identifierGame=I,o.version=L,i=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),q.getToken()&&(o.token=q.getToken()),q.getUser()&&(o.identifierPlayer=q.getUser()),s=JSON.stringify(o),u.data=D.base64(s),u.hash=D.md5(s+"privatekey"),i.open("POST",J,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.onreadystatechange=function(){var e;4===i.readyState&&200===i.status&&(200===i.status?(e=JSON.parse(i.responseText),n(r,o,e,new a(e.status,e.error))):400===i.status&&(e={status:"fail",error:{code:0,message:M[1]}},n(r,o,e,new a(!1,e.error.message))))},i.send(JSON.stringify(u))}function u(e){if(!e)throw"Method getStateAuth: Not exists callback";s("players","verifyToken",function(e,t,n,r){e(n)},function(t){var n={status:"success",response:{}},r={};n.response=r,r.state="disconnected",r.type=void 0,t.error||q.getToken()&&q.getType()&&(r.state="connected",r.type=q.getType()),e(n)},void 0)}function c(e,t,n,r,o){q.unregisterCredential();var i=r||!1;q.registerCredential(e,t,n,i),void 0!==o&&u(o)}function l(e){s("healths","receivedError",function(e,t,n,r){window.console.log("sendError result:"+n.status)},void 0,{error:e})}function d(e){if("success"===e.status){var t=e.response;c(t.identifier,t.token,"facebook",!0,function(e){"success"===e.status?T&&T(e):window.console.log(JSON.stringify(e))})}else"critical"===e.status&&l(e.error),"undefined"!==z?z(e):(window.console.log("It is recommended to assign a function error callback"),window.alert("Error!!! "+JSON.stringify(e.error)))}function f(e){d(e)}function g(){if(R){if(R.closed&&(U=!0,clearInterval(E)),!P)try{var e;e=R.location.href.split("#/response="),e.length>1&&(R.close(),P=!0,f(JSON.parse(decodeURIComponent(e[1]))))}catch(t){R&&R.postMessage("hello there!",x)}}else U=!0}function p(e){e.origin===x&&(P||(U=!0,clearInterval(E),P=!0,window.console.log("se recibio respuesta desde popup: "+e.data),f(JSON.parse(decodeURIComponent(e.data)))))}function h(e,t,n,r){void 0!==e&&e(n)}function v(e,t,n,r){var o={},i=!1;t.rememberMe&&t.rememberMe===!0&&(i=!0),"success"===n.status?q.registerCredential(t.email,n.response,i):(q.unregisterCredential(),o.error=n.error),void 0!==e&&(o.status=n.status,o.response=q.isLogged,e(o))}function m(e,t,n,r){void 0!==e&&(void 0===n.response&&(n.response=JSON.stringify({})),e(n,r))}function w(e,t,n,r){q.unregisterCredential(),void 0!==e&&e({status:"success",response:q.isLogged})}function y(e,t,n,r){void 0!==e&&e(n)}function b(e,t,n,r){void 0!==e&&e(n)}function A(e,t,n,r){void 0!==e&&e(n,r)}function k(e,t,n,r){void 0!==e&&e(n)}function C(e,t,n,r){void 0!==e&&e(n)}function S(e,t,n,r){if(void 0!==e){if("success"===n.status&&n.response&&n.response.length>0){var o=0;n.response.forEach(function(e){e.position=o+1,o+=1})}e(n)}}var N,I,L,O,T,z,R,E,G={},J="http://api.gamezyme.com/",x="http://www.gamezyme.com/",M={1:"General error, this typically means the player is unable to connect to the server",2:"Invalid game credentials, make sure you use the right public key",3:"Request timed out",4:"Invalid request",100:"Entered email is not valid email address",101:"Not found parameters 'user' or 'token' in function 'registerCredential'",102:"Parameter 'typeIdentifier' allowed only value [local-signup, facebook, twitter, googlePlus]"},P=!1,U=!0,q={isLogged:!1,user:void 0,token:void 0,type:void 0},D=function(){function e(e){var t,n,r="";if(!e)return r;for(e=e.replace(/\r\n/g,"\n"),t=0;t<e.length;t+=1)n=e.charCodeAt(t),128>n?r+=String.fromCharCode(n):n>127&&2048>n?(r+=String.fromCharCode(n>>6|192),r+=String.fromCharCode(63&n|128)):(r+=String.fromCharCode(n>>12|224),r+=String.fromCharCode(n>>6&63|128),r+=String.fromCharCode(63&n|128));return r}function t(e,t){var n=1&e|1&t,r=e>>>1|t>>>1;return r<<1|n}function n(e,t){var n=1&e^1&t,r=e>>>1^t>>>1;return r<<1|n}function r(e,t){var n=1&e&(1&t),r=e>>>1&t>>>1;return r<<1|n}function o(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function i(e){var t,n="";for(t=0;3>=t;t+=1)n+=p.charAt(e>>8*t+4&15)+p.charAt(e>>8*t&15);return n}function a(e){var t,n=(e.length+8>>6)+1,r=[],o=8*e.length;for(t=0;16*n>t;t+=1)r.push(0);for(t=0;t<e.length;t+=1)r[t>>2]|=e.charCodeAt(t)<<(8*e.length+t)%4*8;return r[t>>2]|=128<<(8*e.length+t)%4*8,r[16*n-2]=255&o,r[16*n-2]|=(o>>>8&255)<<8,r[16*n-2]|=(o>>>16&255)<<16,r[16*n-2]|=(o>>>24&255)<<24,r}function s(e,t){return e<<t|e>>>32-t}function u(e,t,n,r,i,a){return o(s(o(o(t,e),o(r,a)),i),n)}function c(e,n,o,i,a,s,c){return u(t(r(n,o),r(~n,i)),e,n,a,s,c)}function l(e,n,o,i,a,s,c){return u(t(r(n,i),r(o,~i)),e,n,a,s,c)}function d(e,t,r,o,i,a,s){return u(n(n(t,r),o),e,t,i,a,s)}function f(e,r,o,i,a,s,c){return u(n(o,t(r,~i)),e,r,a,s,c)}var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p="0123456789abcdef",h={};return h.base64=function(t){var n,r,o,i,a,s,u,c="",l=0;for(t=e(t);l<t.length;)n=t.charCodeAt(l),l+=1,r=t.charCodeAt(l),l+=1,o=t.charCodeAt(l),l+=1,i=n>>2,a=(3&n)<<4|r>>4,s=(15&r)<<2|o>>6,u=63&o,isNaN(r)?s=u=64:isNaN(o)&&(u=64),c=c+g.charAt(i)+g.charAt(a)+g.charAt(s)+g.charAt(u);return c},h.md5=function(e){var t,n,r,s,u,g=a(e),p=1732584193,h=-271733879,v=-1732584194,m=271733878;for(u=0;u<g.length;u+=16)t=p,n=h,r=v,s=m,p=c(p,h,v,m,g[u],7,-680876936),m=c(m,p,h,v,g[u+1],12,-389564586),v=c(v,m,p,h,g[u+2],17,606105819),h=c(h,v,m,p,g[u+3],22,-1044525330),p=c(p,h,v,m,g[u+4],7,-176418897),m=c(m,p,h,v,g[u+5],12,1200080426),v=c(v,m,p,h,g[u+6],17,-1473231341),h=c(h,v,m,p,g[u+7],22,-45705983),p=c(p,h,v,m,g[u+8],7,1770035416),m=c(m,p,h,v,g[u+9],12,-1958414417),v=c(v,m,p,h,g[u+10],17,-42063),h=c(h,v,m,p,g[u+11],22,-1990404162),p=c(p,h,v,m,g[u+12],7,1804603682),m=c(m,p,h,v,g[u+13],12,-40341101),v=c(v,m,p,h,g[u+14],17,-1502002290),h=c(h,v,m,p,g[u+15],22,1236535329),p=l(p,h,v,m,g[u+1],5,-165796510),m=l(m,p,h,v,g[u+6],9,-1069501632),v=l(v,m,p,h,g[u+11],14,643717713),h=l(h,v,m,p,g[u],20,-373897302),p=l(p,h,v,m,g[u+5],5,-701558691),m=l(m,p,h,v,g[u+10],9,38016083),v=l(v,m,p,h,g[u+15],14,-660478335),h=l(h,v,m,p,g[u+4],20,-405537848),p=l(p,h,v,m,g[u+9],5,568446438),m=l(m,p,h,v,g[u+14],9,-1019803690),v=l(v,m,p,h,g[u+3],14,-187363961),h=l(h,v,m,p,g[u+8],20,1163531501),p=l(p,h,v,m,g[u+13],5,-1444681467),m=l(m,p,h,v,g[u+2],9,-51403784),v=l(v,m,p,h,g[u+7],14,1735328473),h=l(h,v,m,p,g[u+12],20,-1926607734),p=d(p,h,v,m,g[u+5],4,-378558),m=d(m,p,h,v,g[u+8],11,-2022574463),v=d(v,m,p,h,g[u+11],16,1839030562),h=d(h,v,m,p,g[u+14],23,-35309556),p=d(p,h,v,m,g[u+1],4,-1530992060),m=d(m,p,h,v,g[u+4],11,1272893353),v=d(v,m,p,h,g[u+7],16,-155497632),h=d(h,v,m,p,g[u+10],23,-1094730640),p=d(p,h,v,m,g[u+13],4,681279174),m=d(m,p,h,v,g[u],11,-358537222),v=d(v,m,p,h,g[u+3],16,-722521979),h=d(h,v,m,p,g[u+6],23,76029189),p=d(p,h,v,m,g[u+9],4,-640364487),m=d(m,p,h,v,g[u+12],11,-421815835),v=d(v,m,p,h,g[u+15],16,530742520),h=d(h,v,m,p,g[u+2],23,-995338651),p=f(p,h,v,m,g[u],6,-198630844),m=f(m,p,h,v,g[u+7],10,1126891415),v=f(v,m,p,h,g[u+14],15,-1416354905),h=f(h,v,m,p,g[u+5],21,-57434055),p=f(p,h,v,m,g[u+12],6,1700485571),m=f(m,p,h,v,g[u+3],10,-1894986606),v=f(v,m,p,h,g[u+10],15,-1051523),h=f(h,v,m,p,g[u+1],21,-2054922799),p=f(p,h,v,m,g[u+8],6,1873313359),m=f(m,p,h,v,g[u+15],10,-30611744),v=f(v,m,p,h,g[u+6],15,-1560198380),h=f(h,v,m,p,g[u+13],21,1309151649),p=f(p,h,v,m,g[u+4],6,-145523070),m=f(m,p,h,v,g[u+11],10,-1120210379),v=f(v,m,p,h,g[u+2],15,718787259),h=f(h,v,m,p,g[u+9],21,-343485551),p=o(p,t),h=o(h,n),v=o(v,r),m=o(m,s);return i(p)+i(h)+i(v)+i(m)},h}();return q.registerCredential=function(t,n,r,o){if(!t||!n)throw Gamezyme.ERRORS[101];q.isLogged=!0,q.user=t,q.token=n,q.type=r,o&&(e("user",t),e("token",n),e("type",r))},q.unregisterCredential=function(){q.isLogged=!1,q.user=void 0,q.token=void 0,q.type=void 0,t("user",null),t("token",null),t("type",null)},q.getToken=function(){if(!q.token){var e=t("token");return"null"===e||"undefined"===e?void 0:e}return q.token},q.getUser=function(){return q.user?q.user:t("user")},q.getType=function(){if(!q.type){var e=t("type");return"null"===e||"undefined"===e?void 0:e}return q.type},window.addEventListener?window.addEventListener("message",p,!1):window.attachEvent("message",p),G.init=function(e,t,n){var r,o,i,a,s=document.getElementsByTagName("gs:fb-login-button"),c=e.split("_");if(-1!==c.indexOf("undefined"))throw M[2];if(N=c[0],I=c[1],L="1.0",J+="api/v1?publickey="+N,O=e,void 0!==t&&u(t),void 0!==n&&(z=n),s&&s[0]){if(r=s[0],o=r.getAttribute("onlogin"),i=document.createElement("iframe"),a=document.createElement("span"),!o)throw'Not found "onlogin" function in button login facebook';i.setAttribute("width","1000px"),i.setAttribute("height","1000px"),i.setAttribute("frameborder","0"),i.setAttribute("allowtransparency","true"),i.setAttribute("allowfullscreen","true"),i.setAttribute("scrolling","no"),i.setAttribute("allowfullscreen","true"),i.setAttribute("style","border: none; visibility: visible; width: 65px; height: 22px;"),i.setAttribute("src",J+"/facebook/getButtonLogin"),a.setAttribute("style","vertical-align: bottom; width: 65px; height: 22px;"),a.appendChild(i),r.appendChild(a)}},G.player={localSignUp:function(e,t,n,r){var a=[],u={email:e,password:t,name:n};o("email",e,a),o("password",t,a),o("name",n,a),i(a),q.unregisterCredential(),s("players","localSignUp",h,r,u)},localLogin:function(e,t,n){var r=[],a={email:e,password:t};o("email",e,r),o("password",t,r),i(r),q.unregisterCredential(),s("players","localLogin",v,n,a)},openPopupLoginFacebook:function(e){if(U){var t=600,n=400,r=(window.innerWidth-t)/2,o=(window.innerHeight-n)/2,i=J+"/player/auth/facebook/"+I;R=window.open(i,"LoginWindow","location=1,scrollbars=1,width="+t+",height="+n+",left="+r+",top="+o),R&&(U=!1),P=!1,T=e,E=setInterval(g,1e3)}},isLoggedIn:function(e){var t={status:"success",response:q.isLogged};return void 0===e?t:void e(t)},saveData:function(e,t){s("players","saveData",m,t,{playerDataJSON:e})},getData:function(e){s("players","getData",m,e)},logout:function(e){s("players","logout",w,e)},forgotPassword:function(e,t){var n={email:e};s("players","forgotPassword",y,t,n)},me:function(e){s("players","me",b,e)}},G.game={getAllVars:function(e){s("properties","getGamevars",A,e)},getVar:function(e,t){s("properties","getGamevar",A,t,{key:e})}},G.server={ping:function(e){s("healths","ping",k,e,{type:"html5"})}},G.purchases={register:function(e,t){s("purchases","register",C,t,e)}},G.leaderboard={getGlobal:function(e,t){s("leaderboards","allScores",S,t,{options:e})},getFriends:function(e,t){s("leaderboards","friendsScores",S,t,{options:e})}},G}();if(window.GamezymeAsyncInit&&!window.GamezymeAsyncInit.hasRun&&(window.GamezymeAsyncInit.hasRun=!0,window.GamezymeAsyncInit()),!window.GamezymeAsyncInit)throw"gz.init must have defined var window.GamezymeAsyncInit";